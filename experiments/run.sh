#!/bin/bash
set -e
DOMAIN=$1
EXPDIR=$2

DIR=/home/mohammed/drake-tamp/
PROBLEM_FILE_PATH=$DIR/experiments/$DOMAIN/problems/autogenerated
export CUDA_VISIBLE_DEVICES=""
mkdir -p $EXPDIR && cd $EXPDIR

for FILE in $(ls $PROBLEM_FILE_PATH/*); do
  echo "Running $FILE"
  timeout --signal 9 --foreground 90s python -O $DIR/experiments/main.py --domain=$DOMAIN --algorithm adaptive --mode save --domain-options='{"problem_file": "'$FILE'"}' | tee ./save-$(basename $FILE).log
  timeout --signal 9 --foreground 90s python -O $DIR/experiments/main.py --domain=$DOMAIN --algorithm adaptive --mode oracle --domain-options='{"problem_file": "'$FILE'"}' | tee ./oracle-$(basename $FILE).log
done